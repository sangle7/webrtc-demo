<!-- video A views the user's camera directly -->
<video id="videoA" autoplay></video>
<!-- video B views the user's camera through an RTC connection -->
<video id="videoB" autoplay></video>
<!-- <script src="adapter.js"></script> -->
<script>
	//polyfills
	var RTCPeerConnection = RTCPeerConnection || webkitRTCPeerConnection || mozRTCPeerConnection;
	navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

	//request & load user's stream into videoA
	navigator.getUserMedia({
		video: true,
		audio: true
	}, successHandler, function (error) {
		console.log('failure:', error);
	});


	function successHandler(stream) {
		videoA.srcObject = stream

		//set up the "local" connection, connectionA
		var connectionA = new RTCPeerConnection(null);
		connectionA.onicecandidate = function (event) {
			//give A's ICE candidate to B
			if (event.candidate)
				connectionB.addIceCandidate(new RTCIceCandidate(event.candidate));
		};

		//set up the "remote" connection, connectionB
		var connectionB = new RTCPeerConnection(null);
		connectionB.onicecandidate = function (event) {
			//give B's ICE candidate to A
			if (event.candidate)
				connectionA.addIceCandidate(new RTCIceCandidate(event.candidate));
		};
		connectionB.onaddstream = function (event) {
			//after connection is made, load the stream into videoB
			// videoB.src = URL.createObjectURL(event.stream);
			videoB.srcObject = event.stream
		};

		//set the data sent by connectionA to be the user's video.
		connectionA.addStream(stream);

		//exchange of SDP, started with an offer
		connectionA.createOffer()
			.then(desA => {
				connectionA.setLocalDescription(desA)
				connectionB.setRemoteDescription(desA)
				return connectionB.createAnswer()
			})
			.then(desB => {
				connectionB.setLocalDescription(desB)
				connectionA.setRemoteDescription(desB)
			})
			.catch(err => console.log(err))

	}
</script>